<html>
<head>
  <title>黄金价格2</title>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
  <style>
    .loading-box {
      width: 100%;
      height: 100%;
    }
    .loading-box svg {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      margin: auto;
    }
    .config {
      position: fixed;
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
      z-index: 999;
      background-color: #f8f8f8;
    }
    .config-button {
      cursor: pointer;
      position: absolute;
      right: 10px;
      bottom: 10px;
      width: 40px;
      height: 40px;
      fill: #ccc;
    }
    .buttom {
      width: 90%;
      margin: 0 5%;
      position: absolute;
      bottom: 10px;
      color: white;
      line-height: 40px;
      border-radius: 10px;
      cursor: pointer;
      text-align: center;
      background-color: #009fe9;
    }
  </style>
  <link rel="stylesheet" href="//res.wx.qq.com/open/libs/weui/1.1.2/weui.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/vue"></script>

</head>
<body>
  <div id="app">
    <div class="app-box" v-if="isConnect">
      <div class="weui-cells__title">人民币黄金</div>
      <div class="weui-cells">
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p>银行买入价格</p>
            </div>
            <div class="weui-cell__ft">{{buy}} 人民币/克</div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p>银行卖出价格</p>
            </div>
            <div class="weui-cell__ft">{{sell}} 人民币/克</div>
        </div>
      </div>
      <div class="weui-cells__title">获利情况</div>
      <div class="weui-cells">
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p>浮动盈亏</p>
            </div>
            <div v-if="picked === 'rise'" class="weui-cell__ft">{{((buy - cost) * share).toFixed(2)}} 元</div>
            <div v-else class="weui-cell__ft">{{((cost - sell) * share).toFixed(2)}} 元</div>
        </div>
      </div>
      <!-- 右下部设置按钮 -->
      <svg @click="showConfigPage = true" t="1528994542280" class="config-button" viewBox="0 0 1064 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1055" xmlns:xlink="http://www.w3.org/1999/xlink" width="207.8125" height="200"><defs><style type="text/css"></style></defs><path d="M-48.606208 883.816448M1041.337344 883.816448M45.560832 852.672512M403.534848 510.895104c0-36.704256 12.394496-67.21024 37.6576-92.474368 25.264128-25.264128 55.771136-37.658624 92.475392-37.658624 36.703232 0 67.211264 12.394496 92.475392 37.658624 25.265152 25.264128 37.6576 55.770112 37.6576 92.474368 0 36.70528-12.393472 67.689472-37.6576 92.952576-25.264128 25.263104-55.77216 37.656576-92.475392 37.656576-36.704256 0-67.331072-12.274688-92.475392-37.656576C415.809536 578.226176 403.534848 547.1232 403.534848 510.895104zM219.547648 595.743744c7.626752 27.169792 19.067904 53.865472 32.89088 78.651392l-85.801984 105.347072 97.241088 97.241088 105.335808-85.801984c24.787968 13.824 51.958784 25.264128 79.128576 33.368064l14.30016 134.421504 140.142592 0 14.30016-134.421504c27.170816-8.103936 52.912128-19.544064 79.127552-33.368064l104.869888 85.801984 98.195456-97.241088-86.278144-105.347072c13.346816-24.78592 25.263104-51.480576 33.364992-78.651392l134.424576-14.777344L980.789248 440.823808l-134.424576-14.30016c-8.101888-27.170816-20.018176-52.434944-33.364992-78.651392l86.278144-105.346048-98.195456-98.195456-104.869888 86.278144c-26.692608-13.34784-51.956736-25.264128-79.127552-33.36704L602.785792 62.818304 462.6432 62.818304l-14.30016 134.423552c-28.12416 8.102912-54.340608 20.020224-79.128576 33.36704l-105.335808-86.278144-97.241088 98.195456 85.801984 105.346048c-13.34784 26.217472-24.787968 51.480576-32.89088 78.651392L84.647936 440.823808l0 140.142592L219.547648 595.743744zM1021.78304 852.672512" p-id="1056"></path></svg>
    </div>
    <div class="loading-box" v-else>
      <svg width="200px"  height="200px"  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-radio" style="background: none;"><circle cx="28" cy="75" r="11" ng-attr-fill="{{config.c1}}" fill="#1d3f72"><animate attributeName="fill-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="0s" repeatCount="indefinite"></animate></circle><path d="M28 47A28 28 0 0 1 56 75" fill="none" ng-attr-stroke="{{config.c2}}" stroke-width="10" stroke="#5699d2"><animate attributeName="stroke-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="0.1s" repeatCount="indefinite"></animate></path><path d="M28 25A50 50 0 0 1 78 75" fill="none" ng-attr-stroke="{{config.c3}}" stroke-width="10" stroke="#d8ebf9"><animate attributeName="stroke-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="0.2s" repeatCount="indefinite"></animate></path></svg>
    </div>
    <div class="config page__bd" v-if="showConfigPage">
      <div class="weui-cells__title">购买类型</div>
      <div class="weui-cells weui-cells_radio">
        <label class="weui-cell weui-check__label" for="x11">
          <div class="weui-cell__bd">
            <p>先买入后卖出（买涨）</p>
          </div>
          <div class="weui-cell__ft">
            <input type="radio" class="weui-check" name="radio1" id="x11" value="rise" v-model="picked">
            <span class="weui-icon-checked"></span>
          </div>
        </label>
        <label class="weui-cell weui-check__label" for="x12">
          <div class="weui-cell__bd">
            <p>先卖出后买入（买跌）</p>
          </div>
          <div class="weui-cell__ft">
            <input type="radio" name="radio1" class="weui-check" value="fall" v-model="picked" id="x12">
            <span class="weui-icon-checked"></span>
          </div>
        </label>
      </div>
      <div class="weui-cells__title">持有均价    单位:元</div>
      <div class="weui-cells">
        <div class="weui-cell">
          <div class="weui-cell__bd">
            <input class="weui-input" v-model="cost" type="text" placeholder="请输入均价">
          </div>
        </div>
      </div>
      <div class="weui-cells__title">持有数量    单位:克</div>
      <div class="weui-cells">
        <div class="weui-cell">
          <div class="weui-cell__bd">
            <input class="weui-input" v-model="share" type="text" placeholder="请输入数量">
          </div>
        </div>
      </div>
      <div class="buttom" @click="saveConfug">确认</div>
    </div>
  </div>

  <script>
    let app = new Vue({
      el: '#app',
      data: {
        picked: 'rise',
        isConnect: false,
        showConfigPage: false,
        buy: 0,
        sell: 0,
        cost: 267.42,
        share: 8.4
      },
      methods: {
        saveConfug () {
          this.showConfigPage = false
          const saveData = JSON.stringify({
            cost: this.cost,
            share: this.share
          })
          localStorage.config = saveData
        }
      }
    })
    const ws = new WebSocket("ws://xn--9tr.com:8001")
    ws.onopen = () => {
      // console.log('连接建立成功!')
      ws.send("给我数据")
      setTimeout(() => {
        app.isConnect = true
      }, 2000)
      setInterval(() => {
        ws.send("给我数据")
      }, 5000)
    }
    ws.onmessage = (mess) => {
      console.log('接收到新数据')
      const data = JSON.parse(mess.data)
      app.buy = data.buy
      app.sell = data.sell
    }
    window.onload = () => {
      const configData = localStorage.config
      console.log(configData)
      if (configData) {
        const redData = JSON.parse(configData)
        app.cost = redData.cost
        app.share = redData.share
      } else {
        app.showConfigPage = true
      }
    }
    // 禁止页面拖动
    document.body.addEventListener('touchmove', (e) => {
      e.preventDefault()
    })
  </script>
</body>
</html>
